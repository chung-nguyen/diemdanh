(("undefined"!=typeof globalThis?globalThis:self)["makoChunk_ant-design-pro"]=("undefined"!=typeof globalThis?globalThis:self)["makoChunk_ant-design-pro"]||[]).push([["1af106b0"],{b2251247:function(e,t,l){l.d(t,"__esModule",{value:!0}),l.e(t,{default:function(){return ez;}});var a=l("777fffbe"),d=l("852bbaa9"),n=l("a02a1a92"),r=l("490ee287"),i=a._(r),u=l("52b58eb0"),s=d._(u),o={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 64H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V96c0-17.7-14.3-32-32-32zm-260 72h96v209.9L621.5 312 572 347.4V136zm220 752H232V136h280v296.9c0 3.3 1 6.6 3 9.3a15.9 15.9 0 0022.3 3.7l83.8-59.9 81.4 59.4c2.7 2 6 3.1 9.4 3.1 8.8 0 16-7.2 16-16V136h64v752z"}}]},name:"book",theme:"outlined"},c=l("06ef1031"),h=a._(c),f=s.forwardRef(function(e,t){return s.createElement(h.default,(0,i.default)((0,i.default)({},e),{},{ref:t,icon:o}));}),m=l("5609b1f8"),p=a._(m),g=l("d7762438"),v=a._(g),x=l("0f9bf1bd"),b=a._(x),y=l("99abc9b4"),j=l("6142c812"),I=l("072a79d4"),w=l("1bef6ecc"),C=l("202dcd15"),S=a._(C),_=l("7ac65a45"),P=a._(_),k=l("7addff45"),O=a._(k),T=l("b7bb7adc"),R=a._(T),E=l("a93b3bae"),M=a._(E),L=l("eabb069b"),V=a._(L),F=l("8133fd28"),N=l("e0614a8c"),z=l("dc39d580"),D=l("71de9e31"),A=l("53d5f824"),Y=l("a300da41"),U=a._(Y),q=l("cab75d75"),B=a._(q),H=l("0d65aa14"),Q=a._(H),X=l("45918c80"),K=l("27787319"),W=a._(K);l("46578e1d");var $=l("d6ef43aa"),G=l("3883514c"),J=a._(G);let{Option:Z}=J.default;function ee(e){return(null==e?void 0:e.type)&&(e.type.isSelectOption||e.type.isSelectOptGroup);}let et=s.forwardRef((e,t)=>{var l;let a,d;let{prefixCls:n,className:r,popupClassName:i,dropdownClassName:u,children:o,dataSource:c}=e,h=(0,B.default)(o);1===h.length&&s.isValidElement(h[0])&&!ee(h[0])&&([a]=h);let f=a?()=>a:void 0;d=h.length&&ee(h[0])?o:c?c.map(e=>{if(s.isValidElement(e))return e;switch(typeof e){case"string":return s.createElement(Z,{key:e,value:e},e);case"object":{let{value:t}=e;return s.createElement(Z,{key:t,value:t},e.text);}default:return;}}):[];let{getPrefixCls:m}=s.useContext($.ConfigContext),p=m("select",n),[g]=(0,X.useZIndex)("SelectLike",null===(l=e.dropdownStyle)||void 0===l?void 0:l.zIndex);return s.createElement(J.default,Object.assign({ref:t,suffixIcon:null},(0,Q.default)(e,["dataSource","dropdownClassName"]),{prefixCls:p,popupClassName:i||u,dropdownStyle:Object.assign(Object.assign({},e.dropdownStyle),{zIndex:g}),className:(0,U.default)(`${p}-auto-complete`,r),mode:J.default.SECRET_COMBOBOX_MODE_DO_NOT_USE,getInputElement:f}),d);}),el=(0,W.default)(et);et.Option=Z,et._InternalPanelDoNotUseOrYouWillBeFired=el;var ea=l("143ffe18"),ed=a._(ea),en=l("cfc52dc7");let er=(e,t,l=300)=>{let[a,d]=(0,s.useState)(""),n=(0,en.debounce)(d,l);return{query:(0,w.useQuery)([e,a],()=>t(a),{enabled:!!a}),setQuery:n};},ei=e=>{let{query:t,setQuery:l}=er(e.queryKey,e.fetchSuggestions,300),{data:a,isLoading:d}=t;return(0,n.jsx)(A.ProForm.Item,{...e,style:{width:"100%"},children:(0,n.jsx)(et,{...e.fieldProps,options:a,onSearch:e=>{l(e);},style:{width:"100%"},children:(0,n.jsx)(ed.default.Search,{...e.fieldProps,size:"large",placeholder:String(e.placeholder||""),enterButton:!0,loading:d,style:{width:"100%"}})})});};var eu=l("855cf467"),es=l("4bfd3ee1"),eo=a._(es);let ec=e=>{let{meeting:t,createModalVisible:l,onSubmit:a,onCancel:d}=e;return(0,w.useIntl)(),(0,n.jsxs)(D.DrawerForm,{title:"Th\xeam kh\xe1ch",width:600,open:l,onFinish:a,drawerProps:{onClose:d,destroyOnClose:!0},grid:!0,initialValues:{description:"",key:"",namespace:"",value:""},children:[(0,n.jsx)(eo.default.Item,{label:"H\u1ED9i ngh\u1ECB",style:{width:"100%"},children:(0,n.jsx)(ed.default,{readOnly:!0,value:null==t?void 0:t.name})}),(0,n.jsx)(ei,{colProps:{span:24},name:"guestEmail",label:"Kh\xe1ch m\u1EDDi",queryKey:"autocomplete-guests",fetchSuggestions:async e=>{let t=await (0,eu.search)(e,10);return null==t?void 0:t.map(e=>({value:e.idNumber,label:e.idNumber}));}})]});};var eh=l("6a6ff4c6"),ef=a._(eh),em=l("52461f9d"),ep=a._(em),eg=l("d39b686b"),ev=l("88eaf217"),ex=a._(ev),eb=l("92373139"),ey=a._(eb),ej=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","showSearch","options"],eI=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","options"],ew=s.default.forwardRef(function(e,t){var l=e.fieldProps,a=e.children,d=e.params,r=e.proFieldProps,u=e.mode,o=e.valueEnum,c=e.request,h=e.options,f=(0,ep.default)(e,eI),m=(0,i.default)({options:h,mode:u||"multiple",labelInValue:!0,showSearch:!0,suffixIcon:null,autoClearSearchValue:!0,optionLabelProp:"label"},l),p=(0,s.useContext)(ex.default);return(0,n.jsx)(ey.default,(0,i.default)((0,i.default)({valueEnum:(0,eg.runFunction)(o),request:c,params:d,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,i.default)({getPopupContainer:p.getPopupContainer},m),ref:t,proFieldProps:r},f),{},{children:a}));}),eC=s.default.forwardRef(function(e,t){var l=e.fieldProps,a=e.children,d=e.params,r=e.proFieldProps,u=e.mode,o=e.valueEnum,c=e.request,h=e.showSearch,f=e.options,m=(0,ep.default)(e,ej),p=(0,s.useContext)(ex.default);return(0,n.jsx)(ey.default,(0,i.default)((0,i.default)({valueEnum:(0,eg.runFunction)(o),request:c,params:d,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,i.default)({options:f,mode:u,showSearch:h,getPopupContainer:p.getPopupContainer},l),ref:t,proFieldProps:r},m),{},{children:a}));});eC.SearchSelect=ew,eC.displayName="ProFormComponent";var eS=l("d9e1469e"),e_=a._(eS),eP=l("bf915201"),ek=a._(eP);let eO=({value:e,height:t,...l})=>{let a=(0,s.useRef)(null),d=(0,s.useRef)(null),[r,i]=(0,s.useState)("");return(0,s.useEffect)(()=>{if(!d.current)return;let e=d.current,t=a.current,l=t.getContext("2d"),n=new XMLSerializer().serializeToString(e),r=new Image;r.onload=()=>{t.width=r.width,t.height=r.height,l.drawImage(r,0,0),i(t.toDataURL("image/png"));};let u=new Blob([n],{type:"image/svg+xml;charset=utf-8"}),s=URL.createObjectURL(u);return r.src=s,()=>URL.revokeObjectURL(s);},[e]),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{style:{display:"none"},children:(0,n.jsx)(ek.default,{ref:d,value:e,...l})}),(0,n.jsx)("canvas",{ref:a,style:{display:"none"}}),r&&(0,n.jsx)("img",{src:r,alt:"QR Code",style:{cursor:"pointer",height:t}})]});};var eT=l("544ebdf1"),eR=l("0a6ee672"),eE=a._(eR);let eM=({meeting:e,onSubmit:t,onCancel:l,viewModalVisible:a,values:d,...r})=>{var i,u,o,c,h;(0,w.useIntl)();let f=(0,s.useMemo)(()=>e&&(null==d?void 0:d.guestId)&&(0,eT.getCheckInLink)(d._id),[e,d]);return(0,n.jsxs)(D.DrawerForm,{width:768,open:a,onFinish:t,drawerProps:{onClose:l,destroyOnClose:!0},initialValues:d,children:[(0,n.jsx)(eo.default.Item,{label:"H\u1ED9i ngh\u1ECB",style:{width:"100%"},children:(0,n.jsx)(ed.default,{readOnly:!0,value:null==e?void 0:e.name})}),(0,n.jsx)(e_.default,{colProps:{span:24},name:"seat",label:"S\u1ED1 gh\u1EBF"}),(0,n.jsx)(eo.default.Item,{label:"T\xean kh\xe1ch m\u1EDDi",style:{width:"100%"},children:(0,n.jsx)(ed.default,{readOnly:!0,value:null===(i=null==d?void 0:d.guestId)||void 0===i?void 0:i.fullName})}),(0,n.jsxs)(M.default,{direction:"horizontal",size:"middle",children:[(0,n.jsx)(eo.default.Item,{label:"S\u1ED1 CCCD",style:{width:"100%"},children:(0,n.jsx)(ed.default,{readOnly:!0,value:null===(u=null==d?void 0:d.guestId)||void 0===u?void 0:u.idNumber})}),(0,n.jsx)(eo.default.Item,{label:"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i",style:{width:"100%"},children:(0,n.jsx)(ed.default,{readOnly:!0,value:null===(o=null==d?void 0:d.guestId)||void 0===o?void 0:o.phoneNumber})})]}),(0,n.jsx)(eo.default.Item,{label:"Email",style:{width:"100%"},children:(0,n.jsx)(ed.default,{readOnly:!0,value:null===(c=null==d?void 0:d.guestId)||void 0===c?void 0:c.email})}),(0,n.jsx)(eo.default.Item,{label:"Link \u0111i\u1EC3m danh",style:{width:"100%"},children:(0,n.jsx)(ed.default,{readOnly:!0,value:f})}),(0,n.jsxs)(eE.default,{justify:"center",gap:32,children:[(0,n.jsx)(S.default,{size:256,src:(0,eT.getPhotoURL)((null===(h=null==d?void 0:d.guestId)||void 0===h?void 0:h.idNumber)+".jpg"),icon:(0,n.jsx)(b.default,{})}),!!f&&(0,n.jsx)(eO,{size:256,style:{height:"auto",maxWidth:"50%",width:"50%"},value:f,viewBox:"0 0 256 256"})]}),(0,n.jsx)(eC,{name:"status",label:"T\xecnh tr\u1EA1ng",options:F.AttedanceStatusOptions}),(0,n.jsx)(ef.default,{colProps:{span:24},name:"checkInTime",label:"Th\u1EDDi \u0111i\u1EC3m tham d\u1EF1"})]});},eL=async e=>{let t=O.default.loading("\u0110ang x\u1EED l\xfd");try{return await (0,F.addAttendance)({...e}),t(),O.default.success("\u0110\xe3 th\xeam th\xe0nh c\xf4ng"),!0;}catch(e){var l,a;return t(),(null===(a=e.response)||void 0===a?void 0:null===(l=a.data)||void 0===l?void 0:l.message)&&e.response.data.message.startsWith("E11000")?O.default.error("Kh\xe1ch m\u1EDDi \u0111\xe3 c\xf3 trong danh s\xe1ch! Vui l\xf2ng ch\u1ECDn kh\xe1ch m\u1EDDi kh\xe1c."):O.default.error("Vui l\xf2ng th\u1EED l\u1EA1i!"),!1;}},eV=async(e,t)=>{let l=O.default.loading("\u0110ang x\u1EED l\xfd");try{return await (0,F.updateAttendance)({...t,...e}),l(),O.default.success("C\u1EADp nh\u1EADt th\xe0nh c\xf4ng"),!0;}catch(e){return l(),O.default.error("Vui l\xf2ng th\u1EED l\u1EA1i!"),!1;}},eF=async e=>{let t=O.default.loading("\u0110ang x\u1EED l\xfd");if(!e)return!0;try{return await (0,F.removeAttendances)({ids:e.map(e=>e._id)}),t(),O.default.success("X\xf3a th\xe0nh c\xf4ng!"),!0;}catch(e){return t(),O.default.error("Vui l\xf2ng th\u1EED l\u1EA1i!"),!1;}},eN=async e=>{let t=O.default.loading("\u0110ang x\u1EED l\xfd");try{return await (0,N.generateInviteSheet)(e),t(),O.default.success("\u0110\xe3 x\u1EED l\xfd th\xe0nh c\xf4ng"),!0;}catch(e){return t(),O.default.error("Vui l\xf2ng th\u1EED l\u1EA1i!"),!1;}},ez=()=>{let[e,t]=(0,s.useState)(!1),[l,a]=(0,s.useState)(!1),[d,r]=(0,s.useState)(!1),i=(0,s.useRef)(),[u,o]=(0,s.useState)(),[c,h]=(0,s.useState)([]),[m,g]=(0,s.useState)({width:{show:!1},height:{show:!1},alt:{show:!1}});(0,w.useIntl)();let x=String(new URL(window.location.href).searchParams.get("id")),{data:C,isLoading:_}=(0,w.useQuery)(["attendance-list",x],()=>(0,N.getMeeting)(x),{enabled:!!x}),k=[{title:"S\u1ED1 gh\u1EBF",dataIndex:"seat",sorter:!0},{title:"T\xean kh\xe1ch m\u1EDDi",dataIndex:"guestId",sorter:!0,render:(e,t)=>{var l,d;return(0,n.jsxs)(M.default,{children:[(0,n.jsx)(S.default,{src:(0,eT.getPhotoURL)((null===(l=t.guestId)||void 0===l?void 0:l.idNumber)+".jpg"),icon:(0,n.jsx)(b.default,{})}),(0,n.jsx)("a",{onClick:()=>{a(!0),o(t);},children:null===(d=t.guestId)||void 0===d?void 0:d.fullName})]});}},{title:"CCCD",dataIndex:"guestId",sorter:!0,render:(e,t)=>{var l;return null===(l=t.guestId)||void 0===l?void 0:l.idNumber;}},{title:"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i",dataIndex:"guestId",sorter:!0,render:(e,t)=>{var l;return null===(l=t.guestId)||void 0===l?void 0:l.phoneNumber;}},{title:"Email",dataIndex:"guestId",sorter:!0,render:(e,t)=>{var l;return null===(l=t.guestId)||void 0===l?void 0:l.email;}},{title:"Ch\u1EE9c v\u1EE5",dataIndex:"guestId",sorter:!0,render:(e,t)=>{var l;return null===(l=t.guestId)||void 0===l?void 0:l.office;}},{title:"\u0110\u01A1n v\u1ECB",dataIndex:"guestId",sorter:!0,render:(e,t)=>{var l;return null===(l=t.guestId)||void 0===l?void 0:l.workplace;}},{title:"QR Code",dataIndex:"guestId",sorter:!1,render:(e,t)=>{let l=C&&(null==t?void 0:t.guestId)&&(0,eT.getCheckInLink)(t._id);return(0,n.jsx)(eO,{size:256,height:64,style:{height:"auto",maxWidth:"50%",width:"50%"},value:l,viewBox:"0 0 256 256",children:" "});}},{title:"T\xecnh tr\u1EA1ng",dataIndex:"status",sorter:!0,render:(e,t)=>{var l;return(0,n.jsx)("span",{children:null===(l=F.AttedanceStatusOptions.find(e=>e.value===t.status))||void 0===l?void 0:l.label});}},{title:"Th\u1EDDi \u0111i\u1EC3m",dataIndex:"checkInTime",render:(e,t)=>(0,n.jsx)(M.default,{children:(0,V.default)(t.checkInTime).format("DD MMM YYYY HH:mm")}),sorter:!0},{title:"Created At",dataIndex:"createdAt",render:(e,t)=>(0,n.jsx)(M.default,{children:(0,V.default)(t.createdAt).format("DD MMM YYYY HH:mm")}),hideInTable:!0,hideInSearch:!0},{title:"Updated At",dataIndex:"updatedAt",render:(e,t)=>(0,n.jsx)(M.default,{children:(0,V.default)(t.updatedAt).format("DD MMM YYYY HH:mm")}),hideInTable:!0,hideInSearch:!0},{title:"Thao t\xe1c",dataIndex:"option",valueType:"option",render:(e,t)=>[(0,n.jsx)(R.default,{title:"Ch\u1EAFc ch\u1EAFn?",onConfirm:async()=>{var e,l;await eF([t]),h([]),null===(l=i.current)||void 0===l||null===(e=l.reloadAndRest)||void 0===e||e.call(l);},children:(0,n.jsx)("a",{children:"X\xf3a"})},"delete")]}];return(0,n.jsxs)(j.PageContainer,{loading:_,children:[(0,n.jsx)(I.ProTable,{columnsState:(0,z.tableColumnState)("attendance",m,g),headerTitle:"Danh s\xe1ch",actionRef:i,rowKey:"_id",search:!1,pagination:{showSizeChanger:!0,showQuickJumper:!0,defaultPageSize:20,pageSizeOptions:[20,50,100,200]},toolBarRender:()=>[(0,n.jsxs)(P.default,{type:"primary",onClick:()=>{t(!0);},children:[(0,n.jsx)(p.default,{})," T\u1EA1o m\u1EDBi"]},"primary"),(0,n.jsxs)(P.default,{type:"default",onClick:()=>eN(x),children:[(0,n.jsx)(v.default,{})," Xu\u1EA5t file"]},"default"),(0,n.jsxs)(P.default,{type:"default",onClick:()=>{w.history.push(`/meeting/report?id=${x}`);},children:[(0,n.jsx)(f,{})," B\xe1o c\xe1o"]},"default")],request:(0,F.attendances)(x),columns:k,rowSelection:{onChange:(e,t)=>{h(t);}}}),(null==c?void 0:c.length)>0&&(0,n.jsx)(y.FooterToolbar,{extra:(0,n.jsxs)("div",{children:["Selected\xa0",(0,n.jsx)("a",{style:{fontWeight:600},children:c.length}),"\xa0 items"]}),children:(0,n.jsx)(R.default,{title:"Ch\u1EAFc ch\u1EAFn?",onConfirm:async()=>{var e,t;await eF(c),h([]),null===(t=i.current)||void 0===t||null===(e=t.reloadAndRest)||void 0===e||e.call(t);},children:(0,n.jsx)(P.default,{children:"X\xf3a nhi\u1EC1u d\xf2ng"})},"delete")}),(0,n.jsx)(ec,{meeting:null==C?void 0:C.data,createModalVisible:e,onSubmit:async e=>{(null==C?void 0:C.data._id)&&(e.meetingId=null==C?void 0:C.data._id,await eL(e)&&(t(!1),i.current&&i.current.reload()));},onCancel:()=>{t(!1),o(void 0),r(!1);}}),(0,n.jsx)(eM,{meeting:null==C?void 0:C.data,onSubmit:async e=>{await eV(e,u)&&(a(!1),o(void 0),r(!1),i.current&&i.current.reload());},onCancel:()=>{a(!1),o(void 0),r(!1);},viewModalVisible:l,values:u||{}})]});};}}]);
//# sourceMappingURL=1af106b0-async.28f27aef.js.map